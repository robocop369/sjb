<!DOCTYPE html>
<html>
  <head>
    <title>Data Layer: Dynamic Styling</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
       var map, cachedGeoJson;
       var wrappedGeoJson = [];
       

       $.ajax({
        url: "https://data.cityofchicago.org/resource/k9yb-bpqx.json",
        type: "GET",
        data: {
          "$limit" : 5000,
          "$$app_token" : "8MsoFyxjS53a2z1L0Hjt3XtRz"
        }
       }).done(function(data) {              
        cachedGeoJson = data;

        for(i=0;i<cachedGeoJson.length; i++){
            wrappedGeoJson.push(    
                { type: "Feature", 
                  properties: {
                  ward: cachedGeoJson[i].ward,
                  color: "blue"
                  },
                  geometry: cachedGeoJson[i].the_geom
                  }
            )
           };

        initMap();
      });


      function initMap() {
        var bounds = new google.maps.LatLngBounds();

        map = new google.maps.Map(document.getElementById('map'), {
              //chicago coordinates hard
              center: {lat: 41.845, lng: -87.7},
              zoom: 11.7
            });

        console.log(cachedGeoJson);
        console.log(wrappedGeoJson);
            
        //map.data.addGeoJson(wrappedGeoJson[0]);


        for(i=0;i<wrappedGeoJson.length; i++){
          map.data.addGeoJson(wrappedGeoJson[i]);
        };

        //for every coordinate in every ward obj, find the center + to tag with a label later. Might need an alg here as alt. 
        // for (i = 0; i < wrappedGeoJson.length; i++) {

        //   for (j = 0; j < wrappedGeoJson[i].geometry.coordinates; j++)
        //     bounds.extend(wrappedGeoJson[i].geometry.coordinates);
        //   console.log(bounds.getCenter());
        // }

        //         function polygonCenter(poly) {
        //     const vertices = poly.getPath();

        //     // put all latitudes and longitudes in arrays
        //     const longitudes = new Array(vertices.length).map((_, i) => vertices.getAt(i).lng());
        //     const latitudes = new Array(vertices.length).map((_, i) => vertices.getAt(i).lat());

        //     // sort the arrays low to high
        //     latitudes.sort();
        //     longitudes.sort();

        //     // get the min and max of each
        //     const lowX = latitudes[0];
        //     const highX = latitudes[latitudes.length - 1];
        //     const lowy = longitudes[0];
        //     const highy = longitudes[latitudes.length - 1];

        //     // center of the polygon is the starting point plus the midpoint
        //     const centerX = lowX + ((highX - lowX) / 2);
        //     const centerY = lowy + ((highy - lowy) / 2);

        //     return (new google.maps.LatLng(centerX, centerY));
        // }

        //       calculateCenter(List<LatLng> points) {
        //   var longitudes = points.map((i) => i.longitude).toList();
        //   var latitudes = points.map((i) => i.latitude).toList();

        //   latitudes.sort();
        //   longitudes.sort();

        //   var lowX = latitudes.first;
        //   var highX = latitudes.last;
        //   var lowy = longitudes.first;
        //   var highy = longitudes.last;

        //   var centerX = lowX + ((highX - lowX) / 2);
        //   var centerY = lowy + ((highy - lowy) / 2);

        //   return LatLng(centerX, centerY);
        // }
        
        // When the user hovers, tempt them to click by outlining the wards.
        map.data.addListener('mouseover', function(event) {
          map.data.revertStyle();
          map.data.overrideStyle(event.feature, {strokeWeight: 6});
        });
          // When the user clicks, set 'isColorful', changing the color of the letters.
          map.data.addListener('click', function(event) {
          map.data.overrideStyle(event.feature, {strokeWeight: 8});
          //map.data.overrideStyle(event.feature, {color: red});
        });

        // Color each letter gray. Change the color when the isColorful property
        // is set to true.
        // map.data.setStyle(function(feature) {
        //   var color = 'gray';
        //   if (feature.getProperty('isColorful')) {
        //     color = feature.getProperty('color');
        //   }
        //   return /** @type {!google.maps.Data.StyleOptions} */({
        //     fillColor: color,
        //     strokeColor: color,
        //     strokeWeight: 2
        //   });
        // });

        // Call revertStyle() to remove all overrides. This will use the style rules
        // defined in the function passed to setStyle()
        map.data.addListener('mouseout', function(event) {
          map.data.revertStyle();
        });
        }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMZFIRsA7_WHXMc83EcgwaANy8xWzqnco">
    </script>
  </body>
</html>